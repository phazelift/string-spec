(function(){var i,e,t,n,r,s,a,o,d,l,u,h,c,v,x;a=require("assign-variable"),l=require("@sygn/has-unicode"),u=require("string-intersection"),r=require("message-events"),v=require("@sygn/not-included-characters"),({notString:x,forceString:d,forceObject:o,isFunction:h}=require("types.js")),i=["id","min","max","include","exclude","regexp","unicode","validator"],e=new RegExp,t=function(){return!0},n={0:"",11:"unknown key found in initialization object",12:"include and regexp should not be mixed, regexp now ignored",13:"cannot set max value smaller than min value, max now set to min",14:"invalid initialization prop-type",21:"found not included character(s)",22:"found excluded character(s)",23:"too long",24:"too short",25:"contains unicode character(s)",26:"invalid argument type",27:"regexp validation failed",28:"custom validation failed"},c=new r("error",(function(i,e,t=""){return{sender:"string-spec",method:e<20?"constructor":t,type:"error",id:d(i),code:e,text:n[e]}})),a.onWarn((function(i){if(void 0!==i.value)return c.error(i.id,14)})),s=class{static onError(i){return c.on("error",i)}checkProps(e){var t;for(t in e=o(e))e[t],i.indexOf(t)<0&&c.error(d(e.id),11);return e}constructor(i){return i=this.checkProps(i),this.id=a(i.id,"","id"),this.min=a(i.min,0,"min"),this.max=a(i.max,Infinity,"max"),this.include=a(i.include,"","include"),this.exclude=a(i.exclude,"","exclude"),this.regexp=a(i.regexp,e,"regexp"),this.unicode=a(i.unicode,!1,"unicode"),this.validator=a(i.validator,t,"validator"),this.include&&this.regexp!==e&&(this.regexp=e,c.error(this.id,12)),this.min>this.max&&(this.max=this.min,c.error(this.id,13)),Object.freeze(this)}validationResult(i,e=0,t){return{id:this.id,value:i,code:e,error:n[e],found:t}}assign(i,e){var t,n;return t=i=>h(e)?e(i):d(e),x(i)?(c.error(this.id,26,"assign"),t(this.validationResult(i,26,i))):(n=this.validate(i)).error?t(n):i}validate(i){var t;return x(i)?(c.error(this.id,26,"validate"),this.validationResult(i,26,i)):!this.unicode&&l(i)?this.validationResult(i,25,""):i.length>this.max?this.validationResult(i,23,i.slice(this.max)):i.length<this.min?this.validationResult(i,24,""):this.include.length&&(t=v(i,this.include)).length?this.validationResult(i,21,t.join("")):this.exclude.length&&(t=u(i,this.exclude)).length?this.validationResult(i,22,t.join("")):this.regexp===e||this.regexp.test(i)?this.validator(i)?this.validationResult(i,0,""):this.validationResult(i,28,""):this.validationResult(i,27,"")}},module.exports=s}).call(this);